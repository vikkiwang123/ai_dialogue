# 🔍 ChatGPT调试步骤

## 第一步：检查插件是否加载

1. 访问 https://chat.openai.com
2. 按 **F12** 打开开发者工具
3. 切换到 **Console** 标签
4. 应该能看到：
   ```
   AI对话监控助手 - Content Script 已加载
   检测到平台: chatgpt
   开始监控平台: chatgpt
   ```

**如果没有看到这些日志：**
- 刷新页面（Ctrl+R）
- 检查插件是否在扩展管理页面中启用
- 检查是否有错误信息

## 第二步：运行调试脚本

在Console中粘贴并运行以下代码：

```javascript
// 快速调试脚本
console.log('=== 开始调试 ===');
console.log('1. 查找消息元素:');
const messages = document.querySelectorAll('[data-message-author-role]');
console.log('找到', messages.length, '个消息元素');

if (messages.length > 0) {
  console.log('\n2. 分析第一条消息:');
  const firstMsg = messages[0];
  console.log('角色:', firstMsg.getAttribute('data-message-author-role'));
  console.log('类名:', firstMsg.className);
  console.log('文本长度:', (firstMsg.textContent || '').length);
  
  // 查找内容容器
  const contentSelectors = ['.markdown', '[class*="markdown"]', '.prose'];
  contentSelectors.forEach(sel => {
    const el = firstMsg.querySelector(sel);
    if (el) {
      console.log(`找到内容容器 ${sel}:`, el.textContent.substring(0, 50));
    }
  });
  
  console.log('\n3. 完整文本预览:');
  console.log(firstMsg.textContent.substring(0, 200));
} else {
  console.log('⚠️ 未找到消息元素！');
  console.log('尝试查找其他可能的元素...');
  const allDivs = document.querySelectorAll('div[class*="group"]');
  console.log('找到', allDivs.length, '个可能的div元素');
}

console.log('\n4. 检查存储:');
chrome.storage.local.get(null, (items) => {
  const keys = Object.keys(items).filter(k => k.startsWith('messages_'));
  console.log('存储的消息键:', keys);
  if (keys.length > 0) {
    const today = new Date().toISOString().split('T')[0];
    const todayKey = `messages_${today}`;
    console.log('今日消息数:', items[todayKey]?.length || 0);
  }
});
```

## 第三步：发送测试消息

1. 在ChatGPT中发送一条消息（比如："你好"）
2. 等待AI回复
3. 观察Console中的日志，应该能看到：
   ```
   [ChatGPT适配器] 检测到新消息节点: user
   [监控] 开始处理新消息
   ✅ [监控] 消息已保存: user 你好
   [ChatGPT适配器] 检测到新消息节点: assistant
   ✅ [监控] 消息已保存: assistant [AI的回复]
   ```

## 第四步：检查popup

1. 点击浏览器工具栏中的插件图标
2. 查看"今日统计"
3. 应该能看到消息数量更新

## 常见问题

### 问题1：看到"开始监控"但没有"检测到新消息"

**可能原因：**
- ChatGPT的DOM结构已变化
- 选择器不匹配

**解决方案：**
运行上面的调试脚本，把输出结果告诉我，我会更新适配器

### 问题2：看到"检测到新消息"但没有"消息已保存"

**可能原因：**
- 消息内容提取失败
- 内容太短被过滤

**解决方案：**
查看Console中的详细日志，告诉我看到了什么

### 问题3：消息已保存但popup显示0

**可能原因：**
- 日期不匹配
- 存储键名问题

**解决方案：**
在Console运行：
```javascript
chrome.storage.local.get(null, (items) => {
  console.log('所有存储:', Object.keys(items));
  const today = new Date().toISOString().split('T')[0];
  console.log('今日日期:', today);
  console.log('今日消息:', items[`messages_${today}`]);
});
```

## 需要帮助？

请把以下信息发给我：

1. Console中的完整日志（从打开页面到发送消息）
2. 运行调试脚本的输出
3. popup中显示的统计信息
4. 任何错误信息

这样我可以快速定位问题并修复！


<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI对话监控助手</title>
  <link rel="stylesheet" href="sidepanel.css">
  <link rel="stylesheet" href="../lib/highlight-github.min.css">
</head>
<body>
  <!-- 顶部标题栏 -->
  <header class="header">
    <div class="header-top">
      <h1>🤖 AI对话监控</h1>
      <div class="header-actions">
        <button class="icon-btn" id="refreshBtn" title="刷新数据">🔄</button>
        <button class="icon-btn" id="settingsBtn" title="设置">⚙️</button>
      </div>
    </div>
    <div class="status-bar">
      <div class="status" id="status">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">监控中</span>
      </div>
      <span class="api-badge" id="apiBadge">检查中...</span>
    </div>
  </header>

  <!-- 标签页导航 -->
  <nav class="tab-nav">
    <button class="tab-btn active" data-tab="dashboard">📊 概览</button>
    <button class="tab-btn" data-tab="messages">💬 消息</button>
    <button class="tab-btn" data-tab="search">🔍 搜索</button>
    <button class="tab-btn" data-tab="summary">🧠 总结</button>
  </nav>

  <!-- 标签页内容 -->
  <main class="content">

    <!-- 概览 -->
    <section class="tab-panel active" id="tab-dashboard">
      <div class="stats-grid">
        <div class="stat-card stat-total">
          <div class="stat-icon">💬</div>
          <div class="stat-info">
            <div class="stat-value" id="totalMessages">0</div>
            <div class="stat-label">总消息</div>
          </div>
        </div>
        <div class="stat-card stat-ai">
          <div class="stat-icon">🤖</div>
          <div class="stat-info">
            <div class="stat-value" id="aiMessages">0</div>
            <div class="stat-label">AI回复</div>
          </div>
        </div>
        <div class="stat-card stat-user">
          <div class="stat-icon">👤</div>
          <div class="stat-info">
            <div class="stat-value" id="userMessages">0</div>
            <div class="stat-label">我的消息</div>
          </div>
        </div>
        <div class="stat-card stat-words">
          <div class="stat-icon">📝</div>
          <div class="stat-info">
            <div class="stat-value" id="totalWords">0</div>
            <div class="stat-label">总字数</div>
          </div>
        </div>
      </div>

      <!-- 平台健康状态 -->
      <div class="section-card">
        <h3>📡 平台状态</h3>
        <div class="platform-health" id="platformHealth">
          <div class="empty-hint">加载中...</div>
        </div>
      </div>

      <div class="section-card">
        <h3>📅 最近消息</h3>
        <div class="recent-messages" id="recentMessages">
          <div class="empty-hint">暂无消息</div>
        </div>
      </div>

      <!-- 每日提醒设置 -->
      <div class="section-card">
        <h3>🔔 每日提醒</h3>
        <div class="reminder-settings">
          <div class="reminder-row">
            <span>每日学习提醒</span>
            <label class="switch">
              <input type="checkbox" id="reminderToggle" checked>
              <span class="switch-slider"></span>
            </label>
          </div>
          <div class="reminder-row">
            <span>提醒时间</span>
            <input type="time" id="reminderTime" value="20:00" class="time-input">
          </div>
        </div>
      </div>
    </section>

    <!-- 消息列表 -->
    <section class="tab-panel" id="tab-messages">
      <div class="messages-toolbar">
        <input type="date" id="dateSelector" class="date-input">
        <select id="roleFilter" class="filter-select">
          <option value="all">全部</option>
          <option value="user">我的消息</option>
          <option value="assistant">AI回复</option>
        </select>
        <button class="icon-btn add-btn" id="manualAddBtn" title="手动添加对话">➕</button>
      </div>
      <div class="messages-list" id="messagesList">
        <div class="empty-hint">选择日期查看消息</div>
      </div>
    </section>

    <!-- 搜索 -->
    <section class="tab-panel" id="tab-search">
      <div class="search-toolbar">
        <div class="search-bar">
          <span class="search-icon">🔍</span>
          <input type="text" id="searchInput" class="search-input" placeholder="搜索所有对话记录...">
          <button class="search-clear" id="searchClear" title="清除">✕</button>
        </div>
        <div class="search-filters">
          <select id="searchPlatform" class="filter-select filter-sm">
            <option value="all">全部平台</option>
            <option value="chatgpt">ChatGPT</option>
            <option value="claude">Claude</option>
            <option value="copilot">Copilot</option>
            <option value="gemini">Gemini</option>
            <option value="deepseek">DeepSeek</option>
            <option value="perplexity">Perplexity</option>
          </select>
          <select id="searchRole" class="filter-select filter-sm">
            <option value="all">全部角色</option>
            <option value="user">我的消息</option>
            <option value="assistant">AI回复</option>
          </select>
        </div>
      </div>
      <div class="search-results" id="searchResults">
        <div class="empty-hint">
          <div class="empty-icon">🔍</div>
          <p>输入关键词搜索所有对话记录</p>
          <p class="empty-sub">支持多个关键词，用空格分隔</p>
        </div>
      </div>
    </section>

    <!-- AI总结 -->
    <section class="tab-panel" id="tab-summary">
      <div class="summary-toolbar">
        <input type="date" id="summaryDate" class="date-input">
        <div class="summary-actions">
          <button class="btn btn-ai" id="generateSummary">🤖 生成总结</button>
          <button class="btn btn-outline btn-sm" id="regenerateSummary" style="display: none;">🔄 重新生成</button>
        </div>
      </div>
      <div class="summary-result" id="summaryResult">
        <div class="empty-hint">
          <div class="empty-icon">🧠</div>
          <p>点击「生成总结」让AI分析你今天的对话</p>
          <p class="empty-sub">需要先配置API Key</p>
        </div>
      </div>
    </section>

  </main>

  <!-- 手动添加对话弹窗 -->
  <div class="modal-overlay" id="manualModal" style="display: none;">
    <div class="modal">
      <div class="modal-header">
        <h3>➕ 手动添加对话</h3>
        <button class="modal-close" id="modalClose">✕</button>
      </div>
      <div class="modal-body">
        <p class="modal-hint">当自动抓取失效时，可以手动粘贴对话内容。每行一条消息，支持格式：</p>
        <div class="format-hint">
          <code>用户: 你的问题</code><br>
          <code>AI: AI的回答</code>
        </div>
        <div class="modal-field">
          <label>平台</label>
          <select id="manualPlatform" class="filter-select">
            <option value="chatgpt">ChatGPT</option>
            <option value="claude">Claude</option>
            <option value="copilot">Copilot</option>
            <option value="gemini">Gemini</option>
            <option value="deepseek">DeepSeek</option>
            <option value="perplexity">Perplexity</option>
            <option value="other">其他</option>
          </select>
        </div>
        <div class="modal-field">
          <label>对话内容</label>
          <textarea id="manualContent" class="manual-textarea" rows="10"
            placeholder="用户: 什么是React Hooks?&#10;AI: React Hooks是React 16.8引入的新特性...&#10;用户: 怎么用useEffect?&#10;AI: useEffect是一个副作用Hook..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="modalCancel">取消</button>
        <button class="btn btn-ai" id="modalSave">💾 保存</button>
      </div>
    </div>
  </div>

  <script src="../lib/marked.min.js"></script>
  <script src="../lib/highlight.min.js"></script>
  <script src="../lib/mermaid.min.js"></script>
  <script src="../lib/llm-stream.js"></script>
  <script src="sidepanel.js"></script>
</body>
</html>
